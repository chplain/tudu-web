var Attend=Attend||{};Attend.Category={index:0,input:[],disabledBranch:false,_lang:{params_invalid_category_name:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8003\u52e4\u5206\u7c7b\u540d\u79f0",params_invalid_flow_name:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5ba1\u6279\u6d41\u7a0b\u540d\u79f0",confirm_stop_category:"\u786e\u8ba4\u505c\u7528\u8be5\u8003\u52e4\u5206\u7c7b\uff1f",confirm_delete_category:"\u786e\u8ba4\u5220\u9664\u8be5\u8003\u52e4\u5206\u7c7b\u5417\uff1f",upper_review:"\u4e0a\u7ea7\u5ba1\u6279",uppers_review:"\u9010\u7ea7\u5ba1\u6279",assign_reviewer:"\u6307\u5b9a\u5ba1\u6279\u4eba",params_invalid_flow_name:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u5ba1\u6279\u6d41\u7a0b\u540d\u79f0",confirm_delete_review_flow:"\u786e\u8ba4\u5220\u9664\u8be5\u5ba1\u6279\u6d41\u7a0b\u5417\uff1f",not_delete_step_null:"\u4e0d\u80fd\u5220\u9664\uff0c\u81f3\u5c11\u9700\u4fdd\u7559\u4e00\u4e2a\u5ba1\u6279\u6b65\u9aa4"},stepTpl:['<tr><td align="center">','<div class="step_box_wrap">','<div class="step_box">','<div class="step_box_tool"><span class="icon icon_stepadd"></span>&nbsp;<span class="icon icon_stepprev"></span><span class="icon icon_stepnext"></span>&nbsp;<span class="icon icon_stepclose"></span></div>','<div class="item">','<a style="display:none;" href="javascript:void(0);" class="step_box_item_close"></a>','<p style="display:none;"><input name="" value="1" disabled="disabled" type="text" class="input_text start" size="5" style="width:30px;"> - <input name="" disabled="disabled" type="text" class="input_text end" size="5" style="width:30px;"> '+Lang.days+"\uff0c"+Lang.execute+"</p>",'<p><select style="width:137px;"></select></p>','<p class="null_users" style="display:none;">&nbsp;</p>','<p style="display:none;"><a class="a_select">'+Lang.reviewer+'</a> <input name="" value="" type="text" readonly="readonly" class="input_text i_users" size="5" style="width:90px;"><input name="" value="" type="hidden" class="input_text users"></p>','</div><div class="branch_last"></div>',"</div></div></td></tr>"].join(""),branchTpl:['<div class="step_box_item">','<a href="javascript:void(0);" class="step_box_item_close"></a>','<p><input name="" type="text" class="input_text start" size="5" style="width:30px;"> - <input name="" type="text" class="input_text end" size="5" style="width:30px;"> '+Lang.days+"\uff0c"+Lang.execute+"</p>",'<p><select style="width:137px;"></select></p>','<p class="null_users">&nbsp;</p>','<p style="display:none;"><a class="a_select">'+Lang.reviewer+'</a> <input name="" value="" type="text" class="input_text i_users" size="5" style="width:90px;"><input name="" value="" type="hidden" class="input_text users"></p>',"</div>"].join(""),branchId:[],setLang:function(c){var a=this;for(var b in c){a._lang[b]=c[b]}},init:function(){$("#category-list tr").mousemove(function(){$(this).addClass("current")}).mouseout(function(){$(this).removeClass("current")})},initModify:function(b,a){var c=this;if(b=="create"){c.index=-1;c.addStep()}else{c.initSteps(a)}$('a[name="add-steps"]').bind("click",function(){c.addStep()});$("#theform").submit(function(){return false});$('button[name="save"]').bind("click",function(){$("#theform").find("input").removeClass("border_red");$("#theform").find("div").removeClass("border_red");c.saveCategory("#theform")})},initSteps:function(q){var d=this;d.index=q.length-1;for(var g=0,p=q.length;g<p;g++){var b=q[g].member,t=q[g].branches;if(typeof t!="undefined"){var s=$(['<tr><td align="center"><div class="step_box_wrap"><div class="step_box">','<div class="step_box_tool"><span class="icon icon_stepadd"></span>&nbsp;<span class="icon icon_stepprev"></span><span class="icon icon_stepnext"></span>&nbsp;<span class="icon icon_stepclose"></span></div>','<div class="branch_last"></div></div></div></td></tr>'].join(""));d.branchId[b]=t.length-1;for(var f=0,e=t.length;f<e;f++){var m=$(d.branchTpl),r=t[f].branch,n=parseInt(t[f].type),k="";m.attr({id:"branch-"+b+"-"+r});m.prepend('<input type="hidden" value="'+r+'" name="branch-'+b+'[]" />');m.find("input.start").attr({name:"start-"+b+"-"+r,disabled:false}).val(t[f].start);m.find("input.end").attr({name:"end-"+b+"-"+r,disabled:false}).val(t[f].end);m.find("select").attr({name:"type-"+b+"-"+r,_type:n});m.find("input.users").attr({name:"users-"+b+"-"+r});m.find("input.i_users").attr({name:"i-users-"+b+"-"+r});m.find(".a_select").attr({id:"select-"+b+"-"+r});if(t[f].users!="^upper"&&t[f].users!="^uppers"&&typeof t[f].users!="undefined"){var a=t[f].users;a=a.split(",");m.find("input.users").val(a.join("\n"))}if(n==2){m.find("p:last").show();m.find("p.null_users").hide();k='<option value="0">'+d._lang.upper_review+'</option><option value="1">'+d._lang.uppers_review+'</option><option value="2" selected="selected">'+d._lang.assign_reviewer+"</option>"}else{if(n==1){k='<option value="0">'+d._lang.upper_review+'</option><option value="1" selected="selected">'+d._lang.uppers_review+'</option><option value="2">'+d._lang.assign_reviewer+"</option>";m.find("p.null_users").show()}else{k='<option value="0" selected="selected">'+d._lang.upper_review+'</option><option value="1">'+d._lang.uppers_review+'</option><option value="2">'+d._lang.assign_reviewer+"</option>";m.find("p.null_users").show()}}m.find("select").html(k).bind("change",function(){var i=$(this).closest("tr").attr("id").replace("step-","");var j=$(this).closest("div").attr("id").replace("branch-"+i+"-","");var c=$(this).val();if(parseInt(c)==2){$(this).closest("div").find("p:last").show();$(this).closest("div").find("p.null_users").hide()}else{$(this).closest("div").find("p:last").hide();$(this).closest("div").find("p.null_users").show()}if($("#step-"+i).find(".step_box_item").size()<=1){$(this).closest("div").find("p.null_users").hide()}});m.find(".step_box_item_close").bind("click",function(){var j=$(this).closest("div").attr("id");branchKey=j.split("-")[2],stepKey=j.split("-")[1];var c=$("#step-"+stepKey).find(".step_box_item").size();if(c>=2){$("#branch-"+stepKey+"-"+branchKey).remove();if($("#step-"+stepKey).find(".step_box_item").size()<=1){$("#step-"+stepKey).find('input[name^="branch-"]').remove();$("#step-"+stepKey).find(".mail_input").remove();$("#step-"+stepKey).find(".step_box_item").css({"margin-right":"0px"}).removeAttr("id").children("a").hide();$("#step-"+stepKey).find(".step_box_item select").attr({name:"type-"+stepKey}).bind("change",function(){var l=$('select[name="type-'+stepKey+'"] option:selected').val();if(parseInt(l)==2){$("#step-"+stepKey).find("p:last").show()}else{$("#step-"+stepKey).find("p:last").hide()}});$("#step-"+stepKey).find(".step_box_item").removeClass().addClass("item").children("p:eq(0)").hide();$("#step-"+stepKey).find("input.start, input.end").attr({disabled:true});$("#step-"+stepKey).find("input.users").attr({name:"users-"+stepKey});$("#step-"+stepKey).find("input.i_users").attr({name:"i-users-"+stepKey});$("#step-"+stepKey).find(".a_select").attr({id:"select-"+stepKey});var i=new TOP.ContactInput({id:"review-input-"+stepKey,target:$("#step-"+stepKey).find("input.i_users"),valuePlace:$("#step-"+stepKey).find("input.users"),group:false,contact:false,review:true,jq:jQuery});$("#review-input-"+stepKey).css({display:"inline-block",width:"90px",height:"16px",zoom:1,_display:"inline"});d.initSelectLink("#select-"+stepKey,i,$("#step-"+stepKey).find("input.users"),false,true);if(parseInt($('select[name="type-'+stepKey+'"] option:selected').val())!=2){$("#step-"+stepKey).find("p.null_users").hide()}d.branchId[stepKey]=0}else{$("#step-"+stepKey).find(".step_box_item:last").css({"margin-right":"0px"})}}});m.insertBefore(s.find(".branch_last"))}s.find(".step_box_item:not(:last)").css({"margin-right":"18px"})}else{var s=$(d.stepTpl),k="";d.branchId[b]=0;s.find("select").attr({name:"type-"+b,_type:q[g].type});s.find("input.users").attr({name:"users-"+b});s.find("input.i_users").attr({name:"i-users-"+b});s.find(".a_select").attr({id:"select-"+b});if(q[g].users!="^upper"&&q[g].users!="^uppers"&&typeof q[g].users!="undefined"){var a=q[g].users;a=a.split(",");s.find("input.users").val(a.join("\n"))}if(q[g].type==2){s.find("p:last").show();k='<option value="0">'+d._lang.upper_review+'</option><option value="1">'+d._lang.uppers_review+'</option><option value="2" selected="selected">'+d._lang.assign_reviewer+"</option>"}else{if(q[g].type==1){k='<option value="0">'+d._lang.upper_review+'</option><option value="1" selected="selected">'+d._lang.uppers_review+'</option><option value="2">'+d._lang.assign_reviewer+"</option>"}else{k='<option value="0" selected="selected">'+d._lang.upper_review+'</option><option value="1">'+d._lang.uppers_review+'</option><option value="2">'+d._lang.assign_reviewer+"</option>"}}s.find("select").html(k).bind("change",function(){var c=$(this).val();if(parseInt(c)==2){$(this).closest("div").find("p:last").show()}else{$(this).closest("div").find("p:last").hide()}})}s.attr({id:"step-"+b});s.find(".step_box_wrap").prepend('<input type="hidden" value="'+b+'" name="member[]" /><input type="hidden" value="'+q[g].id+'" name="id-'+b+'" /><input type="hidden" value="'+q[g].order+'" name="order-'+b+'" />');s.find(".step_box_tool .icon_stepadd").bind("click",function(){if(!d.disabledBranch){var c=$(this).closest("tr").attr("id").replace("step-","");d.addBranch($(this).closest("tr"),c);d.refreshOrderNum()}else{TOP.showMessage("\u8865\u7b7e\u5ba1\u6279\u6d41\u7a0b\u4e0d\u5141\u8bb8\u8bbe\u7f6e\u5206\u652f")}});s.find(".step_box_tool .icon_stepclose").bind("click",function(){var c=$(this).closest("tr").attr("id").replace("step-","");d.removeStep(c);d.refreshOrderNum()});s.find(".step_box_tool .icon_stepprev").bind("click",function(){var c=$(this).closest("tr").attr("id").replace("step-","");d.sortStep("up",c);d.refreshOrderNum()});s.find(".step_box_tool .icon_stepnext").bind("click",function(){var c=$(this).closest("tr").attr("id").replace("step-","");d.sortStep("down",c);d.refreshOrderNum()});s.insertBefore("#step-add");s.find("a.a_select").each(function(){var i=$(this).attr("id"),i=i.split("-"),l=i[1];if(i.length==2){var c=new TOP.ContactInput({id:"review-input-"+l,target:s.find('input[name="i-users-'+l+'"]'),valuePlace:s.find('input[name="users-'+l+'"]'),group:false,contact:false,review:true,jq:jQuery});$("#review-input-"+l).css({display:"inline-block",width:"90px",height:"16px",zoom:1,_display:"inline"});d.initSelectLink($(this),c,s.find('input[name="users-'+l+'"]'),false,true)}else{if(i.length==3){var j=i[2];var c=new TOP.ContactInput({id:"review-input-"+l+"-"+j,target:s.find('input[name="i-users-'+l+"-"+j+'"]'),valuePlace:s.find('input[name="users-'+l+"-"+j+'"]'),group:false,contact:false,review:true,jq:jQuery});$("#review-input-"+l+"-"+j).css({display:"inline-block",width:"90px",height:"16px",zoom:1,_display:"inline"});d.initSelectLink($(this),c,s.find('input[name="users-'+l+"-"+j+'"]'),false,true)}}});var h=$('<tr><td align="center"><span class="icon icon_next"></span></td></tr>');h.attr({id:"next-"+b});h.insertBefore("#step-"+b)}},addStep:function(){var c=this,b=$(c.stepTpl),d=c.index+1;c.branchId[d]=0;b.attr({id:"step-"+d});b.find(".step_box select").attr({name:"type-"+d}).html('<option value="0" selected="selected">'+c._lang.upper_review+'</option><option value="1">'+c._lang.uppers_review+'</option><option value="2">'+c._lang.assign_reviewer+"</option>").bind("change",function(){var e=$('select[name="type-'+d+'"] option:selected').val();if(parseInt(e)==2){b.find("p:last").show()}else{b.find("p:last").hide()}});b.find("input.users").attr({name:"users-"+d});b.find("input.i_users").attr({name:"i-users-"+d});b.find(".a_select").attr({id:"select-"+d});b.find(".step_box_wrap").prepend('<input type="hidden" value="'+d+'" name="member[]" /><input type="hidden" value="'+d+'" name="order-'+d+'" />');b.find(".step_box_tool .icon_stepclose").bind("click",function(){c.removeStep(d);c.refreshOrderNum()});b.find(".step_box_tool .icon_stepadd").bind("click",function(){if(!c.disabledBranch){c.addBranch(b,d);c.refreshOrderNum()}else{TOP.showMessage("\u8865\u7b7e\u5ba1\u6279\u6d41\u7a0b\u4e0d\u5141\u8bb8\u8bbe\u7f6e\u5206\u652f")}});b.find(".step_box_tool .icon_stepprev").bind("click",function(){c.sortStep("up",d);c.refreshOrderNum()});b.find(".step_box_tool .icon_stepnext").bind("click",function(){c.sortStep("down",d);c.refreshOrderNum()});b.insertBefore("#step-add");c.input[d]=new TOP.ContactInput({id:"review-input-"+d,target:b.find("input.i_users"),valuePlace:b.find("input.users"),group:false,contact:false,review:true,jq:jQuery});$("#review-input-"+d).css({display:"inline-block",width:"90px",height:"16px",zoom:1,_display:"inline"});c.initSelectLink("#select-"+d,c.input[d],b.find("input.users"),false,true);c.index++;var a=$('<tr><td align="center"><span class="icon icon_next"></span></td></tr>');a.attr({id:"next-"+d});a.insertBefore("#step-"+d)},addBranch:function(e,g){var f=this,d=$(f.branchTpl),b=f.branchId[g],c=b+1;if(b==0){e.find(".item").removeClass("item").addClass("step_box_item").attr({id:"branch-"+g+"-"+b}).children("a").show();e.find(".step_box_item").prepend('<input type="hidden" value="'+b+'" name="branch-'+g+'[]" />');e.find(".step_box_item").children("p:eq(0)").show();e.find("input.start").attr({name:"start-"+g+"-"+b,disabled:false});e.find("input.end").attr({name:"end-"+g+"-"+b,disabled:false});e.find("input.users").attr({name:"users-"+g+"-"+b,disabled:false});e.find("input.i_users").attr({name:"i-users-"+g+"-"+b,disabled:false});e.find(".a_select").attr({id:"select-"+g+"-"+b});var a=new TOP.ContactInput({id:"review-input-"+g+"-"+b,target:e.find("input.i_users"),valuePlace:e.find("input.users"),group:false,contact:false,review:true,jq:jQuery});$("#review-input-"+g+"-"+b).css({display:"inline-block",width:"90px",height:"16px",zoom:1,_display:"inline"});f.initSelectLink("#select-"+g+"-"+b,a,e.find("input.users"),false,true);e.find("select").attr({name:"type-"+g+"-"+b}).bind("change",function(){var i=$(this).closest("tr").attr("id").replace("step-","");var j=$(this).closest("div").attr("id").replace("branch-"+i+"-","");var h=$(this).val();if(parseInt(h)==2){$(this).closest("div").find("p:last").show();$(this).closest("div").find("p.null_users").hide()}else{$(this).closest("div").find("p:last").hide();$(this).closest("div").find("p.null_users").show()}});if(parseInt($('select[name="type-'+g+"-"+b+'"] option:selected').val())!=2){e.find("p.null_users").show()}else{e.find("p.null_users").hide()}e.find(".step_box_item a.step_box_item_close").bind("click",function(){$("#branch-"+g+"-"+b).remove();if($("#step-"+g).find(".step_box_item").size()<=1){$("#step-"+g).find('input[name^="branch-"]').remove();$("#step-"+g).find(".mail_input").remove();$("#step-"+g).find(".step_box_item").css({"margin-right":"0px"}).removeAttr("id").children("a").hide();$("#step-"+g).find(".step_box_item select").attr({name:"type-"+g}).bind("change",function(){var i=$('select[name="type-'+g+'"] option:selected').val();if(parseInt(i)==2){$("#step-"+g).find("p:last").show()}else{$("#step-"+g).find("p:last").hide()}});$("#step-"+g).find(".step_box_item").removeClass().addClass("item").children("p:eq(0)").hide();$("#step-"+g).find("input.start, input.end").attr({disabled:true});$("#step-"+g).find("input.users").attr({name:"users-"+g});$("#step-"+g).find("input.i_users").attr({name:"i-users-"+g});$("#step-"+g).find(".a_select").attr({id:"select-"+g});var h=new TOP.ContactInput({id:"review-input-"+g,target:$("#step-"+g).find("input.i_users"),valuePlace:$("#step-"+g).find("input.users"),group:false,contact:false,review:true,jq:jQuery});$("#review-input-"+g).css({display:"inline-block",width:"90px",height:"16px",zoom:1,_display:"inline"});f.initSelectLink("#select-"+g,h,$("#step-"+g).find("input.users"),false,true);if(parseInt($('select[name="type-'+g+'"] option:selected').val())!=2){$("#step-"+g).find("p.null_users").hide()}f.branchId[g]=0}})}$('select[name="type-'+g+'"]').unbind("change");$("#select-"+g+"").unbind("click");$("#review-input-"+g).remove();d.find("a.step_box_item_close").bind("click",function(){var h=$("#step-"+g).find(".step_box_item").size();if(h>=2){d.remove();if($("#step-"+g).find(".step_box_item").size()<=1){$("#step-"+g).find('input[name^="branch-"]').remove();$("#step-"+g).find(".mail_input").remove();$("#step-"+g).find(".step_box_item").css({"margin-right":"0px"}).removeAttr("id").children("a").hide();$("#step-"+g).find(".step_box_item select").attr({name:"type-"+g}).bind("change",function(){var j=$('select[name="type-'+g+'"] option:selected').val();if(parseInt(j)==2){$("#step-"+g).find("p:last").show()}else{$("#step-"+g).find("p:last").hide()}});$("#step-"+g).find(".step_box_item").removeClass().addClass("item").children("p:eq(0)").hide();$("#step-"+g).find("input.start, input.end").attr({disabled:true});$("#step-"+g).find("input.users").attr({name:"users-"+g});$("#step-"+g).find("input.i_users").attr({name:"i-users-"+g});$("#step-"+g).find(".a_select").attr({id:"select-"+g});var i=new TOP.ContactInput({id:"review-input-"+g,target:$("#step-"+g).find("input.i_users"),valuePlace:$("#step-"+g).find("input.users"),group:false,contact:false,review:true,jq:jQuery});$("#review-input-"+g).css({display:"inline-block",width:"90px",height:"16px",zoom:1,_display:"inline"});f.initSelectLink("#select-"+g,i,$("#step-"+g).find("input.users"),false,true);if(parseInt($('select[name="type-'+g+'"] option:selected').val())!=2){$("#step-"+g).find("p.null_users").hide()}f.branchId[g]=0}else{$("#step-"+g).find(".step_box_item:last").css({"margin-right":"0px"})}}});d.attr({id:"branch-"+g+"-"+c});d.prepend('<input type="hidden" value="'+c+'" name="branch-'+g+'[]" />');d.find("input.start").attr({name:"start-"+g+"-"+c});d.find("input.end").attr({name:"end-"+g+"-"+c});d.find("input.users").attr({name:"users-"+g+"-"+c});d.find("input.i_users").attr({name:"i-users-"+g+"-"+c});d.find(".a_select").attr({id:"select-"+g+"-"+c});d.find("select").attr({name:"type-"+g+"-"+c}).html('<option value="0" selected="selected">'+f._lang.upper_review+'</option><option value="1">'+f._lang.uppers_review+'</option><option value="2">'+f._lang.assign_reviewer+"</option>").bind("change",function(){var i=$(this).closest("tr").attr("id").replace("step-","");var j=$(this).closest("div").attr("id").replace("branch-"+i+"-","");var h=$(this).val();if(parseInt(h)==2){$(this).closest("div").find("p:last").show();$(this).closest("div").find("p.null_users").hide()}else{$(this).closest("div").find("p:last").hide();$(this).closest("div").find("p.null_users").show()}});d.find("p.null_users").show();d.insertBefore("#step-"+g+" .branch_last");var a=new TOP.ContactInput({id:"review-input-"+g+"-"+c,target:d.find("input.i_users"),valuePlace:d.find("input.users"),group:false,contact:false,review:true,jq:jQuery});$("#review-input-"+g+"-"+c).css({display:"inline-block",width:"90px",height:"16px",zoom:1,_display:"inline"});f.initSelectLink("#select-"+g+"-"+c,a,d.find("input.users"),false,true);$("#branch-"+g+"-"+c).prev().css({"margin-right":"18px"});f.branchId[g]++},removeStep:function(b){var a=$("#step-list tr:not(#step-add)").size();if(a>2){$("#step-"+b).remove();$("#next-"+b).remove()}else{TOP.showMessage(this._lang.not_delete_step_null)}},sortStep:function(b,d){var c=$("#step-"+d),a=$("#next-"+d);if(b=="up"){c.insertBefore(c.prev().prev().prev());a.insertBefore(a.prev().prev().prev())}else{if(b=="down"){c.insertAfter(c.next().next());a.insertBefore(a.next().next().next())}}},refreshOrderNum:function(){var b=$(".set_flow_step"),a=0;b.find('input[name^="order-"]').each(function(){$(this).val(a);a++})},initSelectLink:function(e,f,b,d,a){var c=this;if(!d){d=false}if(!a){a=false}$(e).click(function(){var v=this;var u=$(this).text();var h=b.val();var m=[],o=null;if(h){h=h.split("\n");for(var n=0,s=h.length;n<s;n++){var k=h[n];if(k.indexOf(">")==0||k.indexOf("+")==0){m.push({separator:k})}else{var t=k.split(" ");m.push({_id:t[0].replace(/^#+/,""),name:t[1]})}}}else{m=null}var r=["lastcontact","common","contact"];if(a){r=["common"]}var p='<div class="pop pop_linkman"><div class="pop_header"><strong>'+TOP.TEXT.SELECT_CONTACT+'</strong><a class="icon icon_close close"></a></div><div class="pop_body"></div><div class="pop_footer"><button type="button" name="confirm" class="btn">'+TOP.TEXT.CONFIRM+'</button><button type="button" class="btn close">'+TOP.TEXT.CANCEL+"</button></div></div>";var q=TOP.Frame.TempWindow;q.append(p,{width:470,draggalbe:true,onShow:function(){q.center()},onClose:function(){q.destroy()}});var j=new TOP.ContactSelector({appendTo:q.find("div.pop_body"),enableGroup:d,selected:m,mailInput:f,order:a,panels:r});var g=TOP.Cookie.get("CONTACT-PANEL");if(!g){g="common"}j.switchPanel(g);q.find('button[name="confirm"]').bind("click",function(){var w=j.getSelected();if(a){f.clear()}for(var l=0,y=w.length;l<y;l++){var x={};if(w[l].groupid){x.title=w[l].name+"&lt;"+TOP.TEXT.GROUP+"&gt;";x._id=w[l].groupid;x.name=w[l].name}else{if(w[l].email){x.title=w[l].name+(w[l].email?"$lt;"+w[l].email+"&gt;":"");x._id=w[l].email?w[l].email:"";x.name=w[l].name}else{if(w[l].separator){x.separator=x._id=x.name=x.title=w[l].separator}}}f.addItem(x.name,x)}q.close()});q.show()})},saveCategory:function(d){var g=this,d=$(d),f=d.find('input[name="categoryname"]').val().replace(/^\s+|\s+$/,"");if(!f){TOP.showMessage(g._lang.params_invalid_category_name);d.find('input[name="categoryname"]').focus();return false}var c=0;if(g.input.length>0){for(var b in g.input){var a=g.input[b].getItems();a.each(function(){if($(this).attr("title")==TOP.TEXT.INVALID_TO_USER){$("#review-input-"+b).addClass("border_red");c++}})}}if(c>0){TOP.showMessage("\u8868\u5355\u7ea2\u8272\u90e8\u5206\uff0c\u5ba1\u6279\u4eba\u7528\u6237\u8f93\u5165\u683c\u5f0f\u6709\u8bef");return false}var e=d.serializeArray();d.find(":input:not([_disabled])").attr("disabled",true);$.ajax({type:"POST",dataType:"json",data:e,url:d.attr("action"),success:function(j){TOP.showMessage(j.message,5000,j.success?"success":null);d.find(":input:not([_disabled])").attr("disabled",false);if(j.success){location="/app/attend/category/index"}else{if(j.data){var h=j.data;for(var k=0,o=h.length;k<o;k++){if(h[k].indexOf("users")!=-1){var m=h[k].split("-"),n=m[1];if(m.length>=3){var l=m[2];$("#review-input-"+n+"-"+l).addClass("border_red")}else{$("#review-input-"+n).addClass("border_red")}}else{$('input[name="'+h[k]+'"]').addClass("border_red")}}}}},error:function(h){d.find(":input:not([_disabled])").attr("disabled",false);TOP.showMessage(TOP.TEXT.PROCESSING_ERROR)}})},deleteCategory:function(a){if(!confirm(this._lang.confirm_delete_category)){return false}$.ajax({type:"GET",dataType:"json",url:"/app/attend/category/delete?categoryid="+a,success:function(b){TOP.showMessage(b.message,5000,b.success?"success":null);if(b.success){location=location}},error:function(b){TOP.showMessage(TOP.TEXT.PROCESSING_ERROR)}})},updateStatus:function(b,a){if(a==0){if(!confirm(this._lang.confirm_stop_category)){return false}}$.ajax({type:"GET",dataType:"json",url:"/app/attend/category/status?categoryid="+b+"&type="+a,success:function(c){TOP.showMessage(c.message,5000,c.success?"success":null);if(c.success){location=location}},error:function(c){TOP.showMessage(TOP.TEXT.PROCESSING_ERROR)}})}};
