var Attend=Attend||{};Attend.Schedule={_lang:{confirm_delete_schedule:"\u60a8\u786e\u5b9a\u8981\u5220\u9664\u6b64\u6392\u73ed\u65b9\u6848\u5417\uff1f",please_add_step:"\u8bf7\u5148\u6dfb\u52a0\u65b9\u6848",params_invalid_schedule_name:"\u8bf7\u6b63\u786e\u8f93\u5165\u6392\u73ed\u65b9\u6848\u540d\u79f0",week_1:"\u661f\u671f\u4e00",week_2:"\u661f\u671f\u4e8c",week_3:"\u661f\u671f\u4e09",week_4:"\u661f\u671f\u56db",week_5:"\u661f\u671f\u4e94",week_6:"\u661f\u671f\u516d",week_0:"\u661f\u671f\u65e5",worktime_error:"\u4e0a\u73ed\u65f6\u95f4\u4e0d\u80fd\u5927\u4e8e\u4e0b\u73ed\u65f6\u95f4",worktime_not_equal:"\u4e0a\u4e0b\u73ed\u65f6\u95f4\u4e0d\u80fd\u76f8\u7b49",late_must_int:"\u8bf7\u6b63\u786e\u8f93\u5165\u8fdf\u5230\u6807\u51c6\u7684\u65f6\u95f4\u503c\uff0c\u5fc5\u987b\u4e3a\u6b63\u6574\u6570",leave_must_int:"\u8bf7\u6b63\u786e\u8f93\u5165\u65e9\u9000\u6807\u51c6\u7684\u65f6\u95f4\u503c\uff0c\u5fc5\u987b\u4e3a\u6b63\u6574\u6570",time_area_error:"\u8fdf\u5230\u6807\u51c6\u6216\u65e9\u9000\u6807\u51c6\u65f6\u95f4\u533a\u57df\u8bbe\u7f6e\u6709\u8bef"},setLang:function(c){var a=this;for(var b in c){a._lang[b]=c[b]}},init:function(){var b=null;$("#schedule-list tr").mousemove(function(){$(this).addClass("current")}).mouseout(function(){$(this).removeClass("current")});$("#plan-_default").load("/app/attend/schedule/defaultRule");var a=$("table.table_list").outerWidth(true);function c(){var d=document.body.offsetWidth;var e=Math.max(a,d-10);if(a>=d){e+=60}$(".tab-panel-body").css("width",e);b=null}window.onresize=function(){if(b==null){b=setTimeout(function(){c()},100)}};c()},deletePlan:function(a){if(!confirm(this._lang.confirm_delete_schedule)){return false}$.ajax({type:"GET",dataType:"json",url:"/app/attend/schedule/delete?scheduleid="+a,success:function(b){TOP.showMessage(b.message,5000,b.success?"success":null);if(b.success){location=location}},error:function(b){TOP.showMessage(TOP.TEXT.PROCESSING_ERROR)}})},currentId:null,initModify:function(){var b=this;$("#theform").submit(function(){return false});$('input[name="name"]').focus();$('button[name="save"]').bind("click",function(){b.savePlan()});$(".color_grid").click(function(f){b.selectColor(this);TOP.stopEventBuddle(f)});$(document.body).bind("click",function(){$("#color_panel").hide(300)});$("#color_panel").bind("click",function(f){TOP.stopEventBuddle(f)});$('input[name="late-standard"], input[name="late-checkin"], input[name="leave-checkout"]').bind("keyup",function(){this.value=this.value.replace(/[^0-9]+/,"")}).blur(function(){$(this).val(this.value)});$('select[name="checkin-hour"]').bind("change",function(){if(!$(this).val()){$('select[name="checkin-min"] option:first').attr("selected",true);$('input[name="late-standard"], input[name="late-checkin"]').attr("disabled",true).attr("_disabled","disabled")}else{if(!$('select[name="checkin-min"]').val()){$('select[name="checkin-min"]').val("00")}$('input[name="late-standard"], input[name="late-checkin"]').attr("disabled",false);$('input[name="late-standard"], input[name="late-checkin"]').removeAttr("_disabled")}});$('select[name="checkin-min"]').bind("change",function(){if(!$('select[name="checkin-hour"]').val()){$('select[name="checkin-min"] option:first').attr("selected",true)}else{if(!$(this).val()){$(this).val("00")}}});$('select[name="checkout-hour"]').bind("change",function(){if(!$(this).val()){$('select[name="checkout-min"] option:first').attr("selected",true);$('input[name="leave-standard"], input[name="leave-checkout"]').attr("disabled",true).attr("_disabled","disabled")}else{if(!$('select[name="checkout-min"]').val()){$('select[name="checkout-min"]').val("00")}$('input[name="leave-checkout"]').attr("disabled",false);$('input[name="leave-checkout"]').removeAttr("_disabled")}});$('select[name="checkout-min"]').bind("change",function(){if(!$('select[name="checkout-hour"]').val()){$('select[name="checkout-min"] option:first').attr("selected",true)}else{if(!$(this).val()){$(this).val("00")}}});var a=null,d=$("div.readmailinfo").height();function c(){var f=document.documentElement.clientHeight,e=f-137;if(e<d){e=d}$("div.readmailinfo").css("height",e);a=null}window.onresize=function(){if(a==null){a=setTimeout(function(){c()},100)}};c()},selectColor:function(b){var d=$(b),a=$("#color_panel");var c=d.offset();if($("#color_panel:visible").size()){a.hide()}a.css({top:c.top+d.height()+"px",left:c.left+"px"}).show(300);a.find("div.color_block").unbind("click").bind("click",function(){var e=$(this).find('input[name="color"]').val();d.css("background-color",e);$("#theform").find('input[name="bgcolor"]').val(e);a.hide(300)})},savePlan:function(e){var a=this,c=$("#theform");if(c.find('input[name="scheduleid"]').val()!="^default"){var b=$('input[name="name"]').val().replace(/\s+/,"");if(!b){TOP.showMessage(a._lang.params_invalid_schedule_name);$('input[name="name"]').focus();return false}}if(c.find('input[name="scheduleid"]').val()!="^default"){if(!a.judgeData()){return false}}else{if(!a.judgeDefaultData()){return false}}var d=c.serializeArray();c.find(":input:not([_disabled])").attr("disabled",true);$.ajax({type:"POST",dataType:"json",data:d,url:c.attr("action"),success:function(f){TOP.showMessage(f.message,5000,f.success?"success":null);c.find(":input:not([_disabled])").attr("disabled",false);if(f.success){location="/app/attend/schedule/index"}},error:function(f){c.find(":input:not([_disabled])").attr("disabled",false);TOP.showMessage(TOP.TEXT.PROCESSING_ERROR)}})},judgeDefaultData:function(){var g=this,h=[];$('input[name="member[]"]').each(function(){h.push($(this).val())});for(var b=0;b<h.length;b++){var e=h[b],d=e==0?g._lang.week_0:e==1?g._lang.week_1:e==2?g._lang.week_2:e==3?g._lang.week_3:e==4?g._lang.week_4:e==5?g._lang.week_5:e==6?g._lang.week_6:"";if($('select[name="checkintime-hour-'+e+'"]').val()==$('select[name="checkouttime-hour-'+e+'"]').val()){if($('select[name="checkintime-min-'+e+'"]').val()>$('select[name="checkouttime-min-'+e+'"]').val()){TOP.showMessage(d+g._lang.worktime_error);return false}else{if($('select[name="checkintime-min-'+e+'"]').val()==$('select[name="checkouttime-min-'+e+'"]').val()){TOP.showMessage(d+g._lang.worktime_not_equal);return false}}}else{if($('select[name="checkintime-hour-'+e+'"]').val()>$('select[name="checkouttime-hour-'+e+'"]').val()){TOP.showMessage(d+g._lang.worktime_error);return false}}}var c=$('input[name="latestandard"]').val().replace(/\s+/,""),f=$('input[name="latecheckin"]').val().replace(/\s+/,""),a=$('input[name="leavecheckout"]').val().replace(/\s+/,"");if(isNaN(c)||c.indexOf(".")>=0||c.indexOf("-")>=0||isNaN(f)||f.indexOf(".")>=0||f.indexOf("-")>=0){TOP.showMessage(g._lang.late_must_int);return false}if(isNaN(a)||a.indexOf(".")>=0||a.indexOf("-")>=0){TOP.showMessage(g._lang.leave_must_int);return false}if(parseInt(c)>parseInt(f)){TOP.showMessage(g._lang.time_area_error);return false}return true},judgeData:function(){var d=this,b=$('input[name="late-standard"]').val().replace(/\s+/,""),c=$('input[name="late-checkin"]').val().replace(/\s+/,""),a=$('input[name="leave-checkout"]').val().replace(/\s+/,"");if($('select[name="checkin-min"]').val()&&$('select[name="checkout-min"]').val()){if($('select[name="checkin-hour"]').val()==$('select[name="checkout-hour"]').val()){if($('select[name="checkin-min"]').val()>$('select[name="checkout-min"]').val()){TOP.showMessage(d._lang.worktime_error);return false}else{if($('select[name="checkin-min"]').val()==$('select[name="checkout-min"]').val()){TOP.showMessage(d._lang.worktime_not_equal);return false}}}else{if($('select[name="checkin-hour"]').val()>$('select[name="checkout-hour"]').val()){TOP.showMessage(d._lang.worktime_error);return false}}}if(isNaN(b)||b.indexOf(".")>=0||b.indexOf("-")>=0||isNaN(c)||c.indexOf(".")>=0||c.indexOf("-")>=0){TOP.showMessage(d._lang.late_must_int);return false}if(isNaN(a)||a.indexOf(".")>=0||a.indexOf("-")>=0){TOP.showMessage(d._lang.leave_must_int);return false}if(parseInt(b)>parseInt(c)){TOP.showMessage(d._lang.time_area_error);return false}return true},initUserPlan:function(){var a=this;$("#month").bind("change",function(){var c=$("#year").val(),d=$(this).val(),b=$("#unid").val();a.loadCalendar(c,d,b)});$("#year").bind("change",function(){var c=$(this).val(),d=$("#month").val(),b=$("#unid").val();a.loadCalendar(c,d,b)})},loadCalendar:function(b,c,a){$("#schedule-calendar").load("/app/attend/schedule/calendar?year="+b+"&month="+c+"&unid="+a)}};
